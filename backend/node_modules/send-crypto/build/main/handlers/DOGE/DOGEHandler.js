"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DOGEHandler = exports._apiFallbacks = void 0;
const blockchair_1 = require("../../common/apis/blockchair");
const sochain_1 = require("../../common/apis/sochain");
const retry_1 = require("../../lib/retry");
const utils_1 = require("../../lib/utils");
exports._apiFallbacks = {
    fetchUTXO: (testnet, txHash, vOut) => [
        () => sochain_1.Sochain.fetchUTXO(testnet ? "DOGETEST" : "DOGE")(txHash, vOut),
        ...utils_1.shuffleArray(retry_1.onlyMainnet(() => blockchair_1.Blockchair.fetchUTXO(blockchair_1.Blockchair.networks.DOGECOIN)(txHash, vOut), true)),
    ],
    fetchUTXOs: (testnet, address, confirmations) => [
        () => sochain_1.Sochain.fetchUTXOs(testnet ? "DOGETEST" : "DOGE")(address, confirmations),
        ...utils_1.shuffleArray(retry_1.onlyMainnet(() => blockchair_1.Blockchair.fetchUTXOs(blockchair_1.Blockchair.networks.DOGECOIN)(address, confirmations), testnet)),
    ],
    fetchTXs: (testnet, address, confirmations = 0) => [
        () => sochain_1.Sochain.fetchTXs(testnet ? "DOGETEST" : "DOGE")(address, confirmations),
        ...utils_1.shuffleArray(retry_1.onlyMainnet(() => blockchair_1.Blockchair.fetchTXs(blockchair_1.Blockchair.networks.DOGECOIN)(address, confirmations), testnet)),
    ],
    broadcastTransaction: (testnet, hex) => [
        () => sochain_1.Sochain.broadcastTransaction(testnet ? "DOGETEST" : "DOGE")(hex),
        ...utils_1.shuffleArray(retry_1.onlyMainnet(() => blockchair_1.Blockchair.broadcastTransaction(blockchair_1.Blockchair.networks.DOGECOIN)(hex), testnet)),
    ],
};
class DOGEHandler {
}
exports.DOGEHandler = DOGEHandler;
DOGEHandler.getUTXOs = async (testnet, options) => {
    const confirmations = options && options.confirmations !== undefined
        ? options.confirmations
        : 0;
    const endpoints = exports._apiFallbacks.fetchUTXOs(testnet, options.address, confirmations);
    return retry_1.retryNTimes(() => retry_1.fallback(endpoints), 2);
};
DOGEHandler.getUTXO = async (testnet, txHash, vOut) => {
    const endpoints = exports._apiFallbacks.fetchUTXO(testnet, txHash, vOut);
    return retry_1.retryNTimes(() => retry_1.fallback(endpoints), 2);
};
DOGEHandler.getTransactions = async (testnet, options) => {
    const confirmations = options && options.confirmations !== undefined
        ? options.confirmations
        : 0;
    const endpoints = exports._apiFallbacks.fetchTXs(testnet, options.address, confirmations);
    return retry_1.retryNTimes(() => retry_1.fallback(endpoints), 2);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9HRUhhbmRsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvaGFuZGxlcnMvRE9HRS9ET0dFSGFuZGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw2REFBMEQ7QUFDMUQsdURBQW9EO0FBQ3BELDJDQUFxRTtBQUNyRSwyQ0FBK0M7QUFHbEMsUUFBQSxhQUFhLEdBQUc7SUFDekIsU0FBUyxFQUFFLENBQUMsT0FBZ0IsRUFBRSxNQUFjLEVBQUUsSUFBWSxFQUFFLEVBQUUsQ0FBQztRQUMzRCxHQUFHLEVBQUUsQ0FBQyxpQkFBTyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQztRQUNwRSxHQUFHLG9CQUFZLENBQ1gsbUJBQVcsQ0FDUCxHQUFHLEVBQUUsQ0FDRCx1QkFBVSxDQUFDLFNBQVMsQ0FBQyx1QkFBVSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FDOUMsTUFBTSxFQUNOLElBQUksQ0FDUCxFQUNMLElBQUksQ0FDUCxDQUNKO0tBQ0o7SUFFRCxVQUFVLEVBQUUsQ0FBQyxPQUFnQixFQUFFLE9BQWUsRUFBRSxhQUFxQixFQUFFLEVBQUUsQ0FBQztRQUN0RSxHQUFHLEVBQUUsQ0FDRCxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQzdDLE9BQU8sRUFDUCxhQUFhLENBQ2hCO1FBQ0wsR0FBRyxvQkFBWSxDQUNYLG1CQUFXLENBQ1AsR0FBRyxFQUFFLENBQ0QsdUJBQVUsQ0FBQyxVQUFVLENBQUMsdUJBQVUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQy9DLE9BQU8sRUFDUCxhQUFhLENBQ2hCLEVBQ0wsT0FBTyxDQUNWLENBQ0o7S0FDSjtJQUVELFFBQVEsRUFBRSxDQUNOLE9BQWdCLEVB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